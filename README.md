## 1-1. 概要
本プログラムコードは筆者が「統計学入門(統計学入門Ⅰ)」(著：東京大学教養学部出版会)の理解を深める目的で作成されたものである。  　
https://www.amazon.co.jp/%E7%B5%B1%E8%A8%88%E5%AD%A6%E5%85%A5%E9%96%80-%E5%9F%BA%E7%A4%8E%E7%B5%B1%E8%A8%88%E5%AD%A6%E2%85%A0-%E6%9D%B1%E4%BA%AC%E5%A4%A7%E5%AD%A6%E6%95%99%E9%A4%8A%E5%AD%A6%E9%83%A8%E7%B5%B1%E8%A8%88%E5%AD%A6%E6%95%99%E5%AE%A4/dp/4130420658
## 2-1.フォルダ構成
### 2-1-1. distributions
確率分布クラスをまとめたフォルダ。continuousフォルダに連続型の確率分布クラス、discreteフォルダに離散型の確率分布クラスがまとめられている。分布の各論については2-2.を参照のこと。

それぞれの確率分布クラスは基底クラスを継承しており（連続型はContinuousDistributionBase、離散型はDiscreteDistributionBase）、
おのおのの基底クラスは抽象クラスAbstractDistributionを継承している。
### 2-1-2. extensions
拡張メソッドクラスをまとめたフォルダ。今回は階乗や順列、組み合わせなどの演算メソッドを拡張クラスとして実装している。

### 2-1-3. interfaces
インターフェースクラスをまとめたフォルダ。
本プログラムでは依存性逆転の原則(Depemdency Inversion Plinciple)の考え方に則り、積分計算クラスのインターフェースを用意し、依存性注入（DI）によりI/Fと実装を分離している。

## 2-2. 分布
本プログラムにて取り扱う分布を下記に示す。
### 2-2-1. 離散型
・二項分布(BinomialDistribution.cs)

$$f(x) = \cfrac{n!}{(n-x)!x!}p^{x}(1-p)^{n-x}$$

・ベルヌーイ分布(BernouliDistribution.cs)

$$f(x) = p^{x}(1-p)^{1-x}$$

・超幾何分布(HypergeometricDistribution.cs)
### 2-2-2. 連続型
・一様分布(UniformDistribution.cs)

$$f(x) = \cfrac{1}{b-a}$$

・指数分布(ExponentialDistribution.cs)

$$f(x) = \lambda e^{-\lambda x}$$

## 2-3. 特記事項
### 2-3-1. 積分計算について
本プログラムでは連続型関数の定積分は(a)台形近似と(b)モンテカルロ積分を用いて計算している。
### (a). 台形近似
台形近似は数値積分におけるポピュラーな積分近似の方法の一つである。

分割単位を $\Delta x$ とすると、積分区間 $[a, b]$ の定積分の近似式は下記で与えられる。

$$\int_{a}^{b}f(x)dx \approx \sum_{k=0}^{n-1}\cfrac{(f(k) + f(k + 1))\Delta x}{2}$$

また、広義積分については、十分に大きい値 $N$ を定義し、下記で示される式にて計算している。

$$\int_{-\infty}^{\infty}f(x)dx \approx \int_{-N}^{N}f(x)dx$$

### (b). モンテカルロ積分
モンテカルロ積分は乱択アルゴリズムであるモンテカルロ法を応用した積分近似の手法である。

$f(x)$ が区間 $[a,b]$ 一様分布 $p(x)$ に従う場合、

$$\int_{a}^{b}f(x)dx = \int_{a}^{b}\cfrac{f(x)p(x)}{p(x)}dx$$

$$= (b - a)\int_{a}^{b}f(x)p(x)dx$$

$$= (b - a)E(f(x))$$

と表せる。一様分布から抽出した値を $x^{(1)}, x^{(2)}, \dots x^{(N)}$ とすると、Nがじゅうぶんに大きい時、
大数の弱法則によりサンプリングした平均値は真の平均値に収束することが保証されるため下記が成り立つ。

$$\int_{a}^{b}f(x)dx \approx \cfrac{b - a}{N}\sum_{n=1}^{N}f(x^{(n)})$$

本プログラムでは疑似乱数を用いて上式を利用することにより定積分および広義積分を計算している。

## 3. 課題・将来要件など
### 3-1. 広義積分の計算時間
広義積分に限らず積分は必ずしも陽な形式で求まるとは限らない。その場合は近似する必要があるが、広義積分は無限を近似して扱うため非常に多くの計算量を要する。  
近似のパラメータを粗くとることで低減は可能であるが、精度とのトレードオフになる。
実動作ベースでは、広義積分の重積分が発生する多変数関数の分布における期待値や分散などの統計量の計算時間が現実的な時間とならないことが今回明らかになった。
### 検討①
定積分は解析的に解けるものと解析的に解けないものに分類できるが、本プログラムではどちらも統一的に扱い2-2-1の計算方法により積分値を算出している。
解析的に解けるものについては初等関数が求まるため計算が簡易になる（すくなくとも近似計算よりは）ことが多い。継承先で個別に積分計算メソッドを定義し、
基底クラスメソッドをオーバーライドすることを検討するのも有用かもしれない。

### 検討②
テイラー級数近似(マクローリン近似)を行い積分計算をすることも有用かもしれない。精度と計算時間については実験が必要

テイラー級数は多項式であらわされるため解析的な積分計算が容易である
## 4. その他
## 4-1. 学習教材として
本プログラムの作成はソフトウェア開発及びオブジェクト指向言語やＣ＃という言語への理解を深めるための教材としても有用であったと考える。
オブジェクト指向の根底となる基底クラスの継承、インターフェースを作成し実装を分離させ、インターフェースを自体をメソッドに渡すＤＩ参照も行った(SOLID原則のうちの1つである依存性逆転の原則の適用)。  
Ｃ＃としては拡張メソッドの使用、ラムダ式の使用、ジェネリクスの使用といったやや高度なテクニックを要求される場面もあり、中級者以上のエンジニアへの学習教材としても適しているかもしれない。]]

## 答案 4章
# 4. 確率
## 4-1　ド・メレの問題
### i)
> さいころを4回投げるとき、下記のどちらに賭けた方が勝率が高いか？
> 
> (a) 6の目が少なくとも1回出る
> 
> (b) 6の目が1回も出ない

6の目が少なくとも一回出る確率は、
$$1-(\cfrac{5}{6})^4$$

$$= \cfrac{625}{1296} < \cfrac{1}{2}$$

よって１回も出ない方に賭ける方が勝率が高い。
  
**(答). "6の目が1回も出ない"に賭ける**
### ii)
> さいころを2個同時に24回投げるとき、下記のどちらに賭けた方が勝率が高いか？
> 
> (a) (6, 6)の目の組み合わせが少なくとも1回出る
> 
> (b) (6, 6)の目の組み合わせが1回も出ない

(6, 6)の目が少なくとも一回出る確率は

$$1-(\cfrac{35}{36})^{24}$$

$$= 0.491... < \cfrac{1}{2}$$

よって１回も出ない方に賭ける方が勝率が高い。
  
**(答). "(6, 6)の目の組み合わせが1回も出ない"に賭ける**

## 4-2　ホイヘンスの14の問題 第11
> 2個のさいころを何回投げればそのうちの1回は目の和が12になる確率が0.9を超えるか

さいころの目の和が12になる組み合わせは(6,6)の1通りのみである。よって、12になる確率が0.9を超える場合は下記の不等式が成り立つ。

$$1-(\cfrac{36-1}{36})^n > 0.9$$

上記の不等式を満たす最小の $n$ は82となる

**(答). 82回**
## 4-3 (標題なし)
> 30人の看護婦を15人ずつ2組の交代勤務に分ける分け方は何通りあるか

$$_nC_r (n=30, r=15)$$

$$=155117520$$   
  
**(答). 155117520通り**

(注記) 計算に使用したコードは下記
https://github.com/kaz-166/LearningStatistics/blob/692a377ca42b08ca6acda88c09bcf0b2d06b7ec1/LearningStatistics/calcs/Answer.cs#L7-L16
## 4-4　誕生日の問題
> r人の集団中に同じ誕生日の人が少なくとも2人ある確率は
> $$P_r = 1 - (1 - \cfrac{1}{365}) \cdot (1 - \cfrac{2}{365}) \cdot (1 -\cfrac{3}{365}) \dots (1 - \cfrac{(r - 1)}{365})$$
> であることを示せ。
> >  
> さらに、p = 5, 10, 15, 20～25, 30, 35, 40, 50, 60に対して $p_r$ を計算せよ。

$r$人の中で少なくとも１組以上同一の誕生日である組み合わせが存在する確率は  
$$P_r =1 - \cfrac{365!}{365^r \cdot (365 - r)!}$$
$$= 1 - (\cfrac{365}{365} \cdot \cfrac{364}{365} \cdot \cfrac{363}{365} \dots \cfrac{365 - r + 1}{365})$$
$$= 1 - (\cfrac{365}{365} \cdot \cfrac{365-1}{365} \cdot \cfrac{365-2}{365} \dots \cfrac{365 - (r - 1)}{365})$$
$$= 1 - (1 - \cfrac{1}{365}) \cdot (1 - \cfrac{2}{365}) \cdot (1 -\cfrac{3}{365}) \dots (1 - \cfrac{(r - 1)}{365})$$
よって、  
$$P_r = 1 - (1 - \cfrac{1}{365}) \cdot (1 - \cfrac{2}{365}) \cdot (1 -\cfrac{3}{365}) \dots (1 - \cfrac{(r - 1)}{365})$$ 
であることが示された。(証終)
## 4-5　行動科学と確率
> 心理学者が実験を行った。
> 
> ある大学の喫茶店には正方形のテーブルが配置されている。
> 
> 45組の学生客を観察したところ、隣り合って座る学生客は15組、向かい合って座る学生客は30組であった。
> 
> この結果から、心理学者は喫茶店の学生客は向かい合って座るより隣り合って座る方を好む性質があると結論付けた。
> 
> この心理学者の推論は妥当か？

正方形のテーブルに2組が座る場合の組み合わせは、4つの座席に2人を配置する問題と等価であるため、全部で6通りとなる。

また、そのうち隣り合って座る組み合わせは4通り、向かい合って座る組み合わせは2通りである。

座り方に嗜好性がない場合は、隣り合って座る確率は $2/3$ 、向かい合って座る確率は $1/3$ になる。

嗜好性があると仮定した場合、上記の確率とは外れた値になるはずであるが、実験結果は上記確率と一致する。

よって、心理学者の推論は妥当であるとは言えない。

**(答). 妥当ではない**

## 4-6　ガリレイの問題
> 3つのさいころを投げて目の和が9になる場合と10になる場合の目の組み合わせはいずれも6通りである。
>
> このとき、この2つの場合の起こる確率は等しいと言えるか？

目の和が9になる組み合わせは
$(1, 2, 6)$、
$(1, 3, 5)$、
$(1, 4, 4)$、
$(2, 2, 5)$、
$(2, 3, 4)$、
$(3, 3, 3)$
であり、それぞれ場合の数は6通り、6通り、3通り、3通り、6通り、1通りの計25通りであるため、目の和が9になる確率は
$\cfrac{25}{216}$
である。

一方で目の和が10になる組み合わせは
$(1, 3, 6)$、
$(1, 4, 5)$、
$(2, 2, 6)$、
$(2, 3, 5)$、
$(2, 4, 4)$、
$(3, 3, 4)$
であり、それぞれ場合の数は、6通り、6通り、3通り、6通り、3通り、3通りの計27通りであるため、目の和が10になる確率は
$\cfrac{1}{8}$
である。

よって、起こる確率は等しいとは言えない。

**(答). 等しいと言えない**
## 4-7　がんの診断
### i)
> がんを診断するための検査方法があるとする。
>
> $C$ を被検査者はがんであるという事象、 $A$ を検査の結果が被検査者ががんであると示す(検査結果が陽性となる)事象とする。
> 
>  $P(A | C) = 0.95$ 、 $P(A^c | C^c) = 0.95$ 、検査を受ける人の中で実際にがんである確率が $P(C | A) = 0.005$のとき、 $P(C | A)$ を求めよ。

まず、 $P(A^c \mid C)$ を求める。

$$P(C) = P(C \cap (A \cup A^c))$$
$$= P((C \cap A) \cup (C \cap A^c))$$
$$= P(C \cap A) + P(C \cap A^c)$$

乗法定理より、

$$= P(C) \cdot P(A \mid C) + P(C) \cdot P(A^c \mid C)$$

$$\iff P(A^c \mid C) = 1 - P(A \mid C)$$  

$P(A \mid C)=0.95$ より、

$$P(A^c \mid C) = 0.05$$

次に $P(A \mid C^c)$ を求める。

$$P(A \cap C) \cup P(A^c \cap C) \cup P(A \cap C^c) \cup P(A^c \cap C^c) = 1$$

$$\iff  P(C) \cdot P(A \mid C) + P(C) \cdot P(A^c \mid C) + P(C^c) \cdot P(A \mid C^c) + P(C^c) \cdot P(A^c \mid C^c) = 1$$

$P(C)=0.005$  、 $P(A^c \mid C^c)=0.95$ より、  
$$P(A \mid C^c) = 0.05$$  

ベイズの定理より、  
$$P(C|A) = \cfrac{P(C) \cdot P(A \mid C)}{P(C) \cdot P(A \mid C) + P(C^c) \cdot P(A \mid C^c)}$$
$$=0.087155...$$  

**(答). 0.087155**
### ii)
> i)において検査の信頼性が0.95ではなく、一般に $P(A | C) = P(A^c | C^c) = R (0 < R < 1)$ とした場合を考える。
> 
>  $P(C) = 0.005$ とするとき、 $P(C|A) \geq 0.90$ となるための $R$ の条件を求めよ。

$$P(C) \cdot R + P(C) \cdot (1 - R) + P(C^c) \cdot P(A \mid C^c) + P(C^c) \cdot R= 1$$

$$P(A \mid C^c) = \cfrac{1 - P(C) - R \cdot P(C^c)}{P(C^c)}$$

$$P(C|A) \ge 0.9$$

$$R \ge \cfrac{1791}{1792}= 0.999442...$$



